#include <stdio.h>
#include <stdlib.h>
//main
int main(void) {
int n, m, s, i, j, k;
double p1, q1, r1, p2, q2, r2, p12, q12;
//input
printf ("Enter size (m)\n");
scanf ("%d", &m);
printf ("Enter partition (s)\n");
scanf ("%d", &s);
printf ("Enter probabilities:\n");
printf ("Ins in I (p1)\n");
scanf ("%lf", &p1);
printf ("Ins in II (p2)\n");
scanf ("%lf", &p2);
printf ("Ins in I & II (p12)\n");
scanf ("%lf", &p12);
printf ("Del from I (q1)\n");
scanf ("%lf", &q1);
printf ("Del from II (q2)\n");
scanf ("%lf", &q2);
printf ("Del from I & II (q12)\n");
scanf ("%lf", &q12);
r1 = 1 - q1 - q2 - q12;
r2 = 1 - p1 - p2 - p12;
//matrix
n = (m-s+3)*(s+3);
double **A = (double**)malloc(sizeof(double*)*n);
for (i=0; i<n; i++)
   A[i] = (double*)malloc(sizeof(double)*n);
for (i=0; i<n; i++)
   for (j=0; j<n; j++)
      A[i][j] = 0;
//work
for (i=0; i<n; i++) {
//I & II empty
if (i == 0) {
	A[i][(i+1)] = p1*q2 + p1*r1 + p12*q2;
	A[i][(s+1)] = p2*q1 + p2*r1 + p12*q1;
	A[i][i] = p1*q1 + p2*q2 + r2*q2 + r2*q1 + r1*r2 + p1*q12 + p2*q12 + r2*q12 + p12*q12;
	A[i][(s+2)] = p12*r1;
}
//I some II empty
if ((i>0) && (i<s)) {
	A[i][(i+1)] = p1*q2 + p1*r1 + p12*q2;
	A[i][(i+s+1)] = p2*r1 + p12*q1;
	A[i][(i+s)] = p2*q1;
	A[i][i] = p1*q1 + p2*q2 + r2*q2 + r1*r2 + p1*q12 + p12*q12;
	A[i][(i-1)] = r2*q1 + r2*q12 + p2*q12;
	A[i][(i+s+2)] = p12*r1;
}
//I full II empty
if (i == s) {
	A[i][((m-s+1)*(s+1))] = p1*q2 + p1*r1 + p12*q2;
	A[i][(i+s)] = p2*q1;
	A[i][(i+s+1)] = p2*r1;
	A[i][i] = p2*q2 + r2*q2 + r1*r2;
	A[i][((m-s+2)*(s+2)-1)] = p1*q1 + p1*q12 + p12*q12;
	A[i][(i-1)] = r2*q1 + r2*q12 + p2*q12;
	A[i][((m-s+1)*(s+1)+1)] = p12*r1;
	A[i][((m-s+2)*(s+2))] = p12*q1;
}
//II one I empty
if ((i == s+1) && (i != (m-s)*(s+1))) {
	A[i][(i-s)] = p1*q2;
	A[i][i-s-1] = r2*q2 + r2*q12 + p1*q12;
	A[i][(2*i)] = p2*q1 + p2*r1 + p12*q1;
	A[i][i] = p1*q1 + p2*q2 + r2*q1 + r1*r2 + p2*q12 + p12*q12;
	A[i][(i+1)] = p1*r1 + p12*q2;
	A[i][(i+s+2)] = p12*r1;
}
//I some II some
if ((i>s+1) && (i<(m-s)*(s+1)) && ((i-s)%(s+1) != 0)&&(i%(s+1) != 0)) {
	A[i][(i-s)] = p1*q2;
	A[i][(i-s-1)] = r2*q2 + p1*q12;
	A[i][(i+s)] = p2*q1;
	A[i][i] = p1*q1 + p2*q2 + r1*r2 + p12*q12;
	A[i][(i+1)] = p1*r1 + p12*q2;
	A[i][(i+s+1)] = p2*r1 + p12*q1;
	A[i][(i-1)] = q1*r2 + p2*q12;
	A[i][(i+s+2)] = p12*r1;
	A[i][(i-s-2)] = r2*q12;
}
//I full II some
if ((i>s+1) && ((i-s)%(s+1) == 0) && (i != s) && (i<(m-s)*(s+1))) {
	A[i][(((m-s+1)*(s+1)+(i+1)/(s+1)-2))] = p1*q2;
	A[i][(((m-s+1)*(s+1)+(i+1)/(s+1)-1))] = p1*r1 + p12*q2;
	A[i][(i+s)] = p2*q1;
	A[i][i] = p2*q2 + r1*r2;
	A[i][(i-s-1)] = r2*q2;
	A[i][(i+s+1)] = r1*p2;
	A[i][(i-1)] = r2*q1 + p2*q12;
	A[i][(((m-s+2)*(s+2)+(i+1)/(s+1)-2))] = p1*q1 + p12*q12;
	A[i][(((m-s+1)*(s+1)+(i+1)/(s+1)-1)+1)] = p12*r1;
	A[i][(i-s-2)] = r2*q12;
	A[i][(((m-s+2)*(s+2)+(i+1)/(s+1)-2)-1)] = p1*q12;
	A[i][(((m-s+2)*(s+2)+(i+1)/(s+1)-2)+1)] = p12*q1;
}
//II some I empty
if ((i>s+1) && (i%(s+1) == 0) && (i != ((m-s+1)*(s+1)-s-1)) && (i<(m-s)*(s+1))) {
	A[i][(i-s)] = p1*q2;
	A[i][(i+s+1)] = p2*q1 + p2*r1 + p12*q1;
	A[i][i] = p1*q1 + p2*q2 + r1*r2 + r2*q1 + p12*q12 + p2*q12;
	A[i][(i+1)] = r1*p1 + p12*q2;
	A[i][(i-s-1)] = r2*q2 + p1*q12 + r2*q12;
	A[i][(i+s+2)] = p12*r1;
}
//II full I empty
if (i == (m-s)*(s+1)) {
	A[i][(i-s)] = p1*q2;
	A[i][((m-s+1)*(s+1)+m+1)] = p2*q1 + p2*r1 + p12*q1;
	A[i][(n-5)] = p2*q2 + p12*q12 + p2*q12;
	A[i][i] = p1*q1 + r1*r2 + r2*q1;
	A[i][(i+1)] = r1*p1;
	A[i][(i-s-1)] = r2*q2 + p1*q12 + r2*q12;
	A[i][(n-6)] = p12*q2;
	A[i][(((m-s+1)*(s+1)+m+1)-1)] = p12*r1;
}
//II full I some
if ((i>(m-s)*(s+1))&&(i<(m-s+1)*(s+1)-1)) {
	A[i][(i-s)] = p1*q2;
	A[i][(2*(m-s+1)*(s+1)+(m-s+2)-i-1)] = p2*q1;
	A[i][((m-s+2)*(s+2)+(m-s+1)*(s+1)+(m-s+3)-i-4)] = p2*q2 + p12*q12;
	A[i][i] = p1*q1 + r1*r2;
	A[i][(i+1)] = r1*p1;
	A[i][(i-1)] = r2*q1;
	A[i][(i-s-1)] = r2*q2 + p1*q12;
	A[i][(2*(m-s+1)*(s+1)+(m-s+2)-i-2)] = p2*r1 + p12*q1;
	A[i][((2*(m-s+1)*(s+1)+(m-s+2)-i-2)-1)] = p12*r1;
	A[i][(i-s-2)] = r2*q12;
	A[i][(((m-s+2)*(s+2)+(m-s+1)*(s+1)+(m-s+3)-i-4)-1)] = p12*q2;
	A[i][(((m-s+2)*(s+2)+(m-s+1)*(s+1)+(m-s+3)-i-4)+1)] = p2*q12;
}
//I full II full
if (i == (m-s+1)*(s+1)-1) {
	A[i][((m-s+1)*(s+1)+(m-s-1))] = p1*q2;
	A[i][((m-s+1)*(s+1)+(m-s-1)+1)] = p1*r1;
	A[i][((m-s+1)*(s+1)+(m-s-1)+2)] = p2*r1;
	A[i][(2*(m-s+1)*(s+1)+(m-s+2)-i-1)] = p2*q1;
	A[i][((m-s+2)*(s+2)+(m-s+1)*(s+1)+(m-s+3)-i-4)] = p2*q2;
	A[i][(((m-s+2)*(s+2)+(i+1)/(s+1)-2))] = p1*q1;
	A[i][(i-1)] = r2*q1;
	A[i][(i-s-1)] = r2*q2;
	A[i][i] = r1*r2;
	A[i][(i-s-2)] = r2*q12;
	A[i][(n-4)] = p12*r1;
	A[i][(n-3)] = p12*q1;
	A[i][(n-1)] = p12*q2;
	A[i][(n-2)] = p12*q12;
	A[i][(((m-s+2)*(s+2)+(i+1)/(s+1)-2)-1)] = p1*q12;
	A[i][(((m-s+2)*(s+2)+(m-s+1)*(s+1)+(m-s+3)-i-4)+1)] = p2*q12;
}
//I reflective screen
if (i == (m-s+1)*(s+1)) {
	A[i][(2*s)] = p2*q1;
	A[i][(2*s+1)] = p2*r1;
	A[i][((m-s+2)*(s+2)-1)] = p1*q1 + p12*q12 + p1*q12;
	A[i][i] = p1*r1 + p1*q2 + p12*q2;
	A[i][s] = q2*r2 + r1*r2 + p2*q2;
	A[i][(s-1)] = q1*r2 + p2*q12 + r2*q12;
	A[i][(((m-s+2)*(s+2)-1)+1)] = p12*q1;
	A[i][(i+1)] = p12*r1;
}
if ((i > (m-s+1)*(s+1))&&(i < ((m-s+1)*(s+2)-1))) {
	A[i][(i-1)] = p1*q2;
	A[i][((m-s+1)*(s+1)-(s+1)*((m-s+1)*(s+2)-i)+2*s)] = p2*q1;
	A[i][((m-s+1)*(s+1)-(s+1)*((m-s+1)*(s+2)-i)+s)] = p2*q2 + r1*r2;
	A[i][((m-s+1)*(s+1)-(s+1)*((m-s+1)*(s+2)-i)+s-1)] = r2*q1 + p2*q12;
	A[i][((m-s+1)*(s+1)-(s+1)*((m-s+1)*(s+2)-i)-1)] = r2*q2;
	A[i][((m-s+1)*(s+1)-(s+1)*((m-s+1)*(s+2)-i)+2*s+1)] = p2*r1;
	A[i][((m-s+2)*(s+2)-(m-s+1)*(s+1)+i-1)] = p1*q1 + p12*q12;
	A[i][i] = p1*r1 + p12*q2;
	A[i][(((m-s+1)*(s+1)-(s+1)*((m-s+1)*(s+2)-i)+s)-s-2)] = r2*q12;
	A[i][(i+1)] = p12*r1;
	A[i][(((m-s+2)*(s+2)-(m-s+1)*(s+1)+i-1)+1)] = p12*q1;
	A[i][(((m-s+2)*(s+2)-(m-s+1)*(s+1)+i-1)-1)] = p1*q12;
}
if (i == ((m-s+1)*(s+2)-1)) {
	A[i][(i-1)] = p1*q2;
	A[i][(i+2)] = p2*q1;
	A[i][((m-s+1)*(s+1)-1)] = r2*r1;
	A[i][((m-s+1)*(s+1)-2)] = r2*q1;
	A[i][((m-s+2)*(s+2)-(m-s+1)*(s+1)+i-1)] = p1*q1;
	A[i][((m-s+3)*(s+3)-s-5)] = p2*q2;
	A[i][((m-s+1)*(s+1)-s-2)] = q2*r2;
	A[i][(i+1)] = p2*r1;
	A[i][i] = p1*r1;
	A[i][(((m-s+1)*(s+1)-1)-s-2)] = r2*q12;
	A[i][(n-4)] = p12*r1;
	A[i][(n-3)] = p12*q1;
	A[i][(n-1)] = p12*q2;
	A[i][(n-2)] = p12*q12;
	A[i][(((m-s+2)*(s+2)-(m-s+1)*(s+1)+i-1)-1)] = p1*q12;
	A[i][(((m-s+3)*(s+3)-s-5)+1)] = p2*q12;
}
if (i == ((m-s+1)*(s+2))) {
	A[i][(i-2)] = p1*q2;
	A[i][(i+1)] = p2*q1;
	A[i][((m-s+3)*(s+3)-s-5)] = p2*q2;
	A[i][((s+3)*(m-s+2)-3)] = p1*q1;
	A[i][((m-s+1)*(s+1)-1)] = r2*r1;
	A[i][((m-s+1)*(s+1)-s-2)] = q2*r2;
	A[i][((m-s+1)*(s+1)-2)] = r2*q1;
	A[i][i] = p2*r1;
	A[i][(i-1)] = p1*r1;
	A[i][(((m-s+1)*(s+1)-1)-s-2)] = r2*q12;
	A[i][(n-4)] = p12*r1;
	A[i][(n-3)] = p12*q1;
	A[i][(n-1)] = p12*q2;
	A[i][(n-2)] = p12*q12;
	A[i][(((s+3)*(m-s+2)-3)-1)] = p1*q12;
	A[i][(((m-s+3)*(s+3)-s-5)+1)] = p2*q12;
}
if ((i > ((m-s+1)*(s+2)))&&(i < ((m-s+2)*(s+2)-2))) {
	A[i][((m-s-1)*(s+1)+(m-s+2)*(s+2)-i-1)] = p1*q2;
	A[i][(i+1)] = p2*q1;
	A[i][i] = p2*r1 + p12*q1;
	A[i][((s+1)*(m-s)+((m-s+2)*(s+2))-i-3)] = r2*q1;
	A[i][((m-s-1)*(s+1)+(m-s+2)*(s+2)-i-2)] = r2*q2 + p1*q12;
	A[i][((m-s)*(s+1)+(m-s+2)*(s+2)-i-2)] = p1*q1 + r1*r2;
	A[i][((m-s)*(s+1)+(m-s+2)*(s+2)-i-1)] = p1*r1;
	A[i][((m-s+3)*(s+3)-(m-s+2)*(s+2)+i-3)] = p2*q2 + p12*q12;
	A[i][(((m-s)*(s+1)+(m-s+2)*(s+2)-i-2)-s-2)] = r2*q12;
	A[i][(i-1)] = p12*r1;
	A[i][(((m-s+3)*(s+3)-(m-s+2)*(s+2)+i-3)-1)] = p12*q2;
	A[i][(((m-s+3)*(s+3)-(m-s+2)*(s+2)+i-3)+1)] = p2*q12;
}
if (i == ((m-s+2)*(s+2)-2)) {
	A[i][((m-s)*(s+1)-s)] = p1*q2;
	A[i][((m-s)*(s+1))] = p1*q1 + r2*q1 + r1*r2;
	A[i][((m-s)*(s+1)+1)] = p1*r1;
	A[i][i] = p2*q1 + p2*r1 + p12*q1;
	A[i][((m-s-1)*(s+1))] = r2*q2 + r2*q12 + p1*q12;
	A[i][(n-5)] = p2*q2 + p2*q12 + p12*q12;
	A[i][(i-1)] = p12*r1;
	A[i][(n-6)] = p12*q2;
}
if (i == (n-4)) {
	A[i][(((m-s+1)*(s+2)-1)-1)] = p1*q2;
	A[i][((m-s+1)*(s+2)+1)] = p2*q1;
	A[i][((m-s+3)*(s+3)-s-5)] = p2*q2;
	A[i][((s+3)*(m-s+2)-3)] = p1*q1;
	A[i][((m-s+1)*(s+1)-1)] = r2*r1;
	A[i][((m-s+1)*(s+1)-s-2)] = q2*r2;
	A[i][((m-s+1)*(s+1)-2)] = r2*q1;
	A[i][((m-s+1)*(s+2))] = p2*r1;
	A[i][((m-s+1)*(s+2)-1)] = p1*r1;
	A[i][(((m-s+1)*(s+1)-1)-s-2)] = r2*q12;
	A[i][i] = p12*r1;
	A[i][(n-3)] = p12*q1;
	A[i][(n-1)] = p12*q2;
	A[i][(n-2)] = p12*q12;
	A[i][(((s+3)*(m-s+2)-3)-1)] = p1*q12;
	A[i][(((m-s+3)*(s+3)-s-5)+1)] = p2*q12;
}
//II reflective screen
if (i == ((m-s+2)*(s+2)-1)) {
	k = s-1;
	if (k!=0) {
		A[i][(k+1)] = p1*q2 + p1*r1 + p12*q2;
		A[i][(k+s+1)] = p2*r1 + p12*q1;
		A[i][(k+s)] = p2*q1;
		A[i][k] = p1*q1 + p2*q2 + r2*q2 + r1*r2 + p1*q12 + p12*q12;
		A[i][(k-1)] = r2*q1 + r2*q12 + p2*q12;
		A[i][(k+s+2)] = p12*r1;
	}
	else {
		A[i][(k+1)] = p1*q2 + p1*r1 + p12*q2;
		A[i][(s+1)] = p2*q1 + p2*r1 + p12*q1;
		A[i][k] = p1*q1 + p2*q2 + r2*q2 + r2*q1 + r1*r2 + r2*q12 + p1*q12 + p2*q12 + p12*q12;
		A[i][(k+s+2)] = p12*r1;
	}
}
if ((i>(m-s+2)*(s+2)-1) && (i < (m-s+2)*(s+3)-3)) {
	k = s+(i-(m-s+2)*(s+2)+1)*(s+1)-1;
	if (k%(s+1)!=0) {
		A[i][(k-s)] = p1*q2;
		A[i][(k-s-1)] = r2*q2 + p1*q12;
		A[i][(k+s)] = p2*q1;
		A[i][k] = p1*q1 + p2*q2 + r1*r2 + p12*q12;
		A[i][(k+1)] = p1*r1 + p12*q2;
		A[i][(k+s+1)] = p2*r1 + p12*q1;
		A[i][(k-1)] = q1*r2 + p2*q12;
		A[i][(k+s+2)] = p12*r1;
		A[i][(k-s-2)] = r2*q12;
	}
	else {
		A[i][(k-s)] = p1*q2;
		A[i][(k+s+1)] = p2*q1 + p2*r1 + p12*q1;
		A[i][k] = p1*q1 + p2*q2 + r1*r2 + r2*q1 + p2*q12 + p12*q12;
		A[i][(k+1)] = r1*p1 + p12*q2;
		A[i][(k-s-1)] = r2*q2 + p1*q12 + r2*q12;
		A[i][(k+s+2)] = p12*r1;
	}
}
if (i == (m-s+2)*(s+3)-3) {
	k = (m-s+1)*(s+1)-2;
	if (k%(s+1)!=0) {
		A[i][(k-s)] = p1*q2;
		A[i][(2*(m-s+1)*(s+1)+(m-s+2)-k-1)] = p2*q1;
		A[i][((m-s+2)*(s+2)+(m-s+1)*(s+1)+(m-s+3)-k-4)] = p2*q2 + p12*q12;
		A[i][k] = p1*q1 + r1*r2;
		A[i][(k+1)] = r1*p1;
		A[i][(k-1)] = r2*q1;
		A[i][(k-s-1)] = r2*q2 + p1*q12;
		A[i][(2*(m-s+1)*(s+1)+(m-s+2)-k-2)] = p2*r1 + p12*q1;
		A[i][(k-s-2)] = r1*q12;
		A[i][((2*(m-s+1)*(s+1)+(m-s+2)-k-2)-1)] = p12*r1;
		A[i][(((m-s+2)*(s+2)+(m-s+1)*(s+1)+(m-s+3)-k-4)-1)] = p12*q2;
		A[i][(((m-s+2)*(s+2)+(m-s+1)*(s+1)+(m-s+3)-k-4)+1)] = p2*q12;
	}
	else {
		A[i][(k-s)] = p1*q2;
		A[i][((m-s+1)*(s+1)+m+1)] = p2*q1 + p2*r1 + p12*q1;
		A[i][(n-5)] = p2*q2 + p12*q12 + p2*q12;
		A[i][k] = p1*q1 + r1*r2 + r2*q1;
		A[i][(k+1)] = r1*p1;
		A[i][(k-s-1)] = r2*q2 + p1*q12 + r2*q12;
		A[i][(((m-s+1)*(s+1)+m+1)-1)] = p12*r1;
		A[i][(n-6)] = p12*q2;
	}
}
if (i == (m-s+2)*(s+3)-2) {
	k = (m-s+1)*(s+1)-s-2;
	if (k!=s) {
		A[i][(((m-s+1)*(s+1)+(k+1)/(s+1)-2))] = p1*q2;
		A[i][(((m-s+1)*(s+1)+(k+1)/(s+1)-1))] = p1*r1 + p12*q2;
		A[i][(k+s)] = p2*q1;
		A[i][k] = p2*q2 + r1*r2;
		A[i][(k-s-1)] = r2*q2;
		A[i][(k+s+1)] = r1*p2;
		A[i][(k-1)] = r2*q1 + p2*q12;
		A[i][(((m-s+2)*(s+2)+(k+1)/(s+1)-2))] = p1*q1 + p12*q12;
		A[i][(k-s-2)] = r2*q12;
		A[i][(((m-s+1)*(s+1)+(k+1)/(s+1)-1)+1)] = p12*r1;
		A[i][(((m-s+2)*(s+2)+(k+1)/(s+1)-2)+1)] = p12*q1;
		A[i][(((m-s+2)*(s+2)+(k+1)/(s+1)-2)-1)] = p1*q12;
	}
	else {
		A[i][((m-s+1)*(s+1))] = p1*q2 + p1*r1 + p12*q2;
		A[i][(k+s)] = p2*q1;
		A[i][(k+s+1)] = p2*r1;
		A[i][k] = p2*q2 + r2*q2 + r1*r2;
		A[i][((m-s+2)*(s+2)-1)] = p1*q1 + p1*q12 + p12*q12;
		A[i][(k-1)] = r2*q1 + r2*q12 + p2*q12;
		A[i][(((m-s+1)*(s+1))+1)] = p12*r1;
		A[i][(((m-s+2)*(s+2)-1)+1)] = p12*q1;
	}
}
if ((i > (m-s+2)*(s+3)-2) && (i < n-5)) {
	k = (s+1)*(m-s-1)+(m-s+3)*(s+3)-i-5;
	if (k>s) {
		A[i][(k-s)] = p1*q2;
		A[i][(k-s-1)] = r2*q2 + p1*q12;
		A[i][(k+s)] = p2*q1;
		A[i][k] = p1*q1 + p2*q2 + r1*r2 + p12*q12;
		A[i][(k+1)] = p1*r1 + p12*q2;
		A[i][(k+s+1)] = p2*r1 + p12*q1;
		A[i][(k-1)] = q1*r2 + p2*q12;
		A[i][(k-s-2)] = r2*q12;
		A[i][(k+s+2)] = p12*r1;
	}
	else {
		A[i][(k+1)] = p1*q2 + p1*r1 + p12*q2;
		A[i][(k+s+1)] = p2*r1 + p12*q1;
		A[i][(k+s)] = p2*q1;
		A[i][k] = p1*q1 + p2*q2 + r2*q2 + r1*r2 + p12*q12 + p1*q12;
		A[i][(k-1)] = r2*q1 + r2*q12 + p2*q12;
		A[i][(k+s+2)] = p12*r1;
	}
}
if (i == n-5) {
	k = (m-s-1)*(s+1);
	if (k!=0) {
		A[i][(k-s)] = p1*q2;
		A[i][(k+s+1)] = p2*q1 + p2*r1 + p12*q1;
		A[i][k] = p1*q1 + p2*q2 + r1*r2 + r2*q1 + p12*q12 + p2*q12;
		A[i][(k+1)] = r1*p1 + p12*q2;
		A[i][(k-s-1)] = r2*q2 + p1*q12 + r2*q12;
		A[i][(k+s+2)] = p12*r1;
	}
	else {
		A[i][(k+1)] = p1*q2 + p1*r1 + p12*q2;
		A[i][(s+1)] = p2*q1 + p2*r1 + p12*q1;
		A[i][k] = p1*q1 + p2*q2 + r2*q2 + r2*q1 + r1*r2 + p12*q12 + r2*q12 + p2*q12 + p1*q12;
		A[i][(k+s+2)] = p12*r1;
	}
}
if (i == n-3) {
	k = (m-s+1)*(s+1)-2;
	if (k%(s+1)!=0) {
		A[i][(k-s)] = p1*q2;
		A[i][(2*(m-s+1)*(s+1)+(m-s+2)-k-1)] = p2*q1;
		A[i][((m-s+2)*(s+2)+(m-s+1)*(s+1)+(m-s+3)-k-4)] = p2*q2 + p12*q12;
		A[i][k] = p1*q1 + r1*r2;
		A[i][(k+1)] = r1*p1;
		A[i][(k-1)] = r2*q1;
		A[i][(k-s-1)] = r2*q2 + p1*q12;
		A[i][(2*(m-s+1)*(s+1)+(m-s+2)-k-2)] = p2*r1 + p12*q1;
		A[i][(k-s-2)] = r1*q12;
		A[i][((2*(m-s+1)*(s+1)+(m-s+2)-k-2)-1)] = p12*r1;
		A[i][(((m-s+2)*(s+2)+(m-s+1)*(s+1)+(m-s+3)-k-4)-1)] = p12*q2;
		A[i][(((m-s+2)*(s+2)+(m-s+1)*(s+1)+(m-s+3)-k-4)+1)] = p2*q12;
	}
	else {
		A[i][(k-s)] = p1*q2;
		A[i][((m-s+1)*(s+1)+m+1)] = p2*q1 + p2*r1 + p12*q1;
		A[i][(n-5)] = p2*q2 + p12*q12 + p2*q12;
		A[i][k] = p1*q1 + r1*r2 + r2*q1;
		A[i][(k+1)] = r1*p1;
		A[i][(k-s-1)] = r2*q2 + p1*q12 + r2*q12;
		A[i][(((m-s+1)*(s+1)+m+1)-1)] = p12*r1;
		A[i][(n-6)] = p12*q2;
	}
}
if (i == n-1) {
	k = (m-s+1)*(s+1)-s-2;
	if (k!=s) {
		A[i][(((m-s+1)*(s+1)+(k+1)/(s+1)-2))] = p1*q2;
		A[i][(((m-s+1)*(s+1)+(k+1)/(s+1)-1))] = p1*r1 + p12*q2;
		A[i][(k+s)] = p2*q1;
		A[i][k] = p2*q2 + r1*r2;
		A[i][(k-s-1)] = r2*q2;
		A[i][(k+s+1)] = r1*p2;
		A[i][(k-1)] = r2*q1 + p2*q12;
		A[i][(((m-s+2)*(s+2)+(k+1)/(s+1)-2))] = p1*q1 + p12*q12;
		A[i][(k-s-2)] = r2*q12;
		A[i][(((m-s+1)*(s+1)+(k+1)/(s+1)-1)+1)] = p12*r1;
		A[i][(((m-s+2)*(s+2)+(k+1)/(s+1)-2)+1)] = p12*q1;
		A[i][(((m-s+2)*(s+2)+(k+1)/(s+1)-2)-1)] = p1*q12;
	}
	else {
		A[i][((m-s+1)*(s+1))] = p1*q2 + p1*r1 + p12*q2;
		A[i][(k+s)] = p2*q1;
		A[i][(k+s+1)] = p2*r1;
		A[i][k] = p2*q2 + r2*q2 + r1*r2;
		A[i][((m-s+2)*(s+2)-1)] = p1*q1 + p1*q12 + p12*q12;
		A[i][(k-1)] = r2*q1 + r2*q12 + p2*q12;
		A[i][(((m-s+1)*(s+1))+1)] = p12*r1;
		A[i][(((m-s+2)*(s+2)-1)+1)] = p12*q1;
	}
}
if (i == n-2) {
	k = (((m-s+1)*(s+1)-1)-s-2);
	if (k==0) {
		A[i][(i+1)] = p1*q2 + p1*r1 + p12*q2;
		A[i][(s+1)] = p2*q1 + p2*r1 + p12*q1;
		A[i][i] = p1*q1 + p2*q2 + r2*q2 + r2*q1 + r1*r2 + p1*q12 + p2*q12 + r2*q12 + p12*q12;
		A[i][(s+2)] = p12*r1;
	}
	if (k%(s+1)==0) {
		A[i][(k-s)] = p1*q2;
		A[i][(k+s+1)] = p2*q1 + p2*r1 + p12*q1;
		A[i][k] = p1*q1 + p2*q2 + r1*r2 + r2*q1 + p2*q12 + p12*q12;
		A[i][(k+1)] = r1*p1 + p12*q2;
		A[i][(k-s-1)] = r2*q2 + p1*q12 + r2*q12;
		A[i][(k+s+2)] = p12*r1;
	}
	if (k<s) {
		A[i][(k+1)] = p1*q2 + p1*r1 + p12*q2;
		A[i][(k+s+1)] = p2*r1 + p12*q1;
		A[i][(k+s)] = p2*q1;
		A[i][k] = p1*q1 + p2*q2 + r2*q2 + r1*r2 + p12*q12 + p1*q12;
		A[i][(k-1)] = r2*q1 + r2*q12 + p2*q12;
		A[i][(k+s+2)] = p12*r1;
	}
	else {
		A[i][(k-s)] = p1*q2;
		A[i][(k-s-1)] = r2*q2 + p1*q12;
		A[i][(k+s)] = p2*q1;
		A[i][k] = p1*q1 + p2*q2 + r1*r2 + p12*q12;
		A[i][(k+1)] = p1*r1 + p12*q2;
		A[i][(k+s+1)] = p2*r1 + p12*q1;
		A[i][(k-1)] = q1*r2 + p2*q12;
		A[i][(k-s-2)] = r2*q12;
		A[i][(k+s+2)] = p12*r1;
	}
}
}
//output
FILE *result = fopen("result.txt","w");
for (i=0; i<n; i++) {
   for (j=0; j<n; j++)
      fprintf(result,"%.3f ",A[i][j]);
   fprintf(result,"\n");
}
fclose(result);
for (i=0; i<n; i++)
   free(A[i]);
free(A);
return 0;
}

